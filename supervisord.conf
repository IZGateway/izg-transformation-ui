[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:xform_console]
command=bash -c "/app/replace-variable.sh && npm start"
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5

[program:filebeats]
command=bash -c '[ -n "$ELASTIC_API_KEY" ] && /usr/bin/filebeat -e || echo "Filebeat not started - ELASTIC_API_KEY not set"'
directory=/app
autostart=true
autorestart=unexpected
exitcodes=0,1,2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5

[program:metricbeats]
command=bash -c '[ -n "$ELASTIC_API_KEY" ] && /usr/bin/metricbeat -e || echo "Metricbeat not started - ELASTIC_API_KEY not set"'
directory=/app
autostart=true
autorestart=unexpected
exitcodes=0,1,2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startsecs=5
